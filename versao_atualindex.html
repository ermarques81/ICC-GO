<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CardioAssist - Suporte √† Decis√£o em ICC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .main-button {
            transition: all 0.2s ease-in-out;
        }
        .main-button:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .main-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .checklist-item {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .checklist-item.checked {
            background-color: #dcfce7; /* green-100 */
            color: #166534; /* green-800 */
        }
        .decision-btn {
            transition: all 0.2s ease;
        }
        .decision-btn.selected {
            background-color: #2563eb; /* blue-600 */
            color: white;
            transform: scale(1.05);
        }
        .calculator-tab.active {
            border-bottom-color: #2563eb;
            color: #2563eb;
        }
        .calculator-tab.disabled-tab {
            color: #9ca3af; /* gray-400 */
            cursor: not-allowed;
            opacity: 0.6;
            border-bottom-color: transparent;
        }
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }
        .autofill-input {
            background-color: #e5e7eb; /* gray-200 */
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app-container" class="max-w-md mx-auto bg-white min-h-screen shadow-lg">

        <!-- Tela Inicial (Dashboard) -->
        <div id="dashboard" class="screen active p-6">
            <header class="text-center mb-8">
                <h1 class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500 py-2">CardioAssist</h1>
                <p class="text-gray-500 max-w-xs mx-auto">Suporte √† Decis√£o para Insufici√™ncia Card√≠aca Aguda</p>
            </header>
            <main class="space-y-4">
                <button id="btn-dashboard-abcde" onclick="showScreen('avaliacao-imediata')" class="main-button w-full bg-red-500 hover:bg-red-600 text-white p-4 rounded-lg shadow-md flex items-center justify-center text-lg font-semibold tracking-wide">
                    <span class="text-2xl mr-4">üöë</span> AVALIA√á√ÉO ABCDE
                </button>
                <button id="btn-dashboard-perfil" onclick="showScreen('estratificar-tratar')" class="main-button w-full bg-indigo-500 hover:bg-indigo-600 text-white p-4 rounded-lg shadow-md flex items-center justify-center text-lg font-semibold tracking-wide" disabled>
                    <span class="text-2xl mr-4">üß≠</span> DEFINIR PERFIL
                </button>
                <button id="btn-dashboard-terapia" onclick="proceedToTherapy(true)" class="main-button w-full bg-sky-500 hover:bg-sky-600 text-white p-4 rounded-lg shadow-md flex items-center justify-center text-lg font-semibold tracking-wide" disabled>
                    <span class="text-2xl mr-4">üíä</span> CENTRO TERAP√äUTICO
                </button>
                 <button id="btn-dashboard-scores" onclick="showScreen('score-risco')" class="main-button w-full bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg shadow-md flex items-center justify-center text-lg font-semibold tracking-wide" disabled>
                    <span class="text-2xl mr-4">üìà</span> SCORES DE RISCO
                </button>
                <button id="btn-dashboard-causas" onclick="showScreen('investigar-causa')" class="main-button w-full bg-amber-500 hover:bg-amber-600 text-white p-4 rounded-lg shadow-md flex items-center justify-center text-lg font-semibold tracking-wide" disabled>
                    <span class="text-2xl mr-4">üîç</span> INVESTIGAR CAUSAS
                </button>
                <button id="btn-dashboard-destino" onclick="showScreen('criterios-destino')" class="main-button w-full bg-slate-500 hover:bg-slate-600 text-white p-4 rounded-lg shadow-md flex items-center justify-center text-lg font-semibold tracking-wide" disabled>
                    <span class="text-2xl mr-4">‚û°Ô∏è</span> ASSESSOR DE DESTINO
                </button>
                <button id="btn-dashboard-prescricao" onclick="showPrescriptionScreen()" class="main-button w-full bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg shadow-md flex items-center justify-center text-lg font-semibold tracking-wide" disabled>
                    <span class="text-2xl mr-4">üìù</span> OTIMIZAR PRESCRI√á√ÉO
                </button>
                <button id="btn-dashboard-alta" onclick="showScreen('otimizacao-alta')" class="main-button w-full bg-teal-500 hover:bg-teal-600 text-white p-4 rounded-lg shadow-md flex items-center justify-center text-lg font-semibold tracking-wide" disabled title="Checklist para o momento da alta hospitalar.">
                    <span class="text-2xl mr-4">‚≠ê</span> CHECKLIST DE ALTA
                </button>
                 <button onclick="showScreen('referencias')" class="main-button w-full bg-gray-700 hover:bg-gray-800 text-white p-4 rounded-lg shadow-md flex items-center justify-center text-lg font-semibold tracking-wide">
                    <span class="text-2xl mr-4">üìö</span> REFER√äNCIAS
                </button>
            </main>
        </div>

        <!-- Tela de Avalia√ß√£o Imediata (ABCDE) -->
        <div id="avaliacao-imediata" class="screen">
             <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üöë Avalia√ß√£o ABCDE</h2>
            </header>
            <main class="p-6 space-y-4">
                <!-- Se√ß√µes ABCDE -->
                <div>
                    <h3 class="font-bold text-lg">A - Vias A√©reas</h3>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center mt-2" data-id="viasAereas">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span>Vias A√©reas P√©rvias?</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1 pl-2">Avaliar risco de rebaixamento do n√≠vel de consci√™ncia.</p>
                    <div id="airway-alert" class="hidden p-3 mt-2 text-center border-l-4 border-red-500 bg-red-100 rounded-r-lg">
                       <p class="font-bold text-red-800">ALERTA CR√çTICO: VIA A√âREA COMPROMETIDA</p>
                       <p class="text-sm">Esta √© a prioridade m√°xima. Chame ajuda e prepare para manejo avan√ßado de via a√©rea (ex: IOT).</p>
                    </div>
                </div>

                <div>
                    <h3 class="font-bold text-lg">B - Respira√ß√£o</h3>
                    <div class="space-y-2 mt-2">
                        <input type="number" id="input-fr" placeholder="Frequ√™ncia Respirat√≥ria (irpm)" class="w-full p-2 border rounded">
                        <input type="number" id="input-spo2" placeholder="Satura√ß√£o de O‚ÇÇ (%)" class="w-full p-2 border rounded">
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-id="musculaturaAcessoria">
                            <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                            <span>Uso de musculatura acess√≥ria / Desconforto respirat√≥rio</span>
                        </div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-id="estertores">
                            <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                            <span>Ausculta com estertores crepitantes</span>
                        </div>
                        <div id="vni-alert" class="hidden p-3 mt-2 text-center border-l-4 border-yellow-500 bg-yellow-100 rounded-r-lg">
                           <p class="font-bold text-yellow-800">ALERTA: INSUFICI√äNCIA RESPIRAT√ìRIA</p>
                           <p class="text-sm">Inicie VNI (CPAP/BiPAP) e monitore a resposta de perto.</p>
                        </div>
                        <div id="iot-alert" class="hidden p-3 mt-2 text-center border-l-4 border-red-500 bg-red-100 rounded-r-lg">
                           <p class="font-bold text-red-800">ALERTA CR√çTICO: FAL√äNCIA RESPIRAT√ìRIA</p>
                           <p class="text-sm">Chame a equipe de via a√©rea e prepare para Intuba√ß√£o Orotraqueal (IOT) imediatamente. Use VNI como ponte, se poss√≠vel.</p>
                        </div>
                        <div id="congestion-alert" class="hidden p-3 mt-2 text-center border-l-4 border-cyan-500 bg-cyan-50 rounded-r-lg">
                           <p class="font-bold text-cyan-800">ALERTA: SINAL DE CONGEST√ÉO PULMONAR</p>
                           <p class="text-sm">Este achado sugere que o paciente est√° "√ömido" (congesto) e provavelmente necessitar√° de diur√©ticos.</p>
                        </div>
                    </div>
                </div>

                 <div>
                    <h3 class="font-bold text-lg">C - Circula√ß√£o</h3>
                     <div class="space-y-2 mt-2">
                        <input type="number" id="input-fc" placeholder="Frequ√™ncia Card√≠aca (bpm)" class="w-full p-2 border rounded">
                        <input type="number" id="input-pas" placeholder="Press√£o Arterial Sist√≥lica (mmHg)" class="w-full p-2 border rounded">
                        <input type="number" id="input-pam" placeholder="Press√£o Arterial M√©dia (mmHg)" class="w-full p-2 border rounded">
                         <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-id="peleFria">
                             <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                             <span>Pele fria/pegajosa, enchimento capilar > 2s</span>
                         </div>
                         <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-id="acessosVenosos">
                             <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                             <span>Obter 2 acessos venosos perif√©ricos</span>
                         </div>
                         <div id="hypotension-alert" class="hidden p-3 mt-2 text-center border-l-4 border-red-500 bg-red-100 rounded-r-lg">
                           <p class="font-bold text-red-800">ALERTA CR√çTICO: HIPOTENS√ÉO / CHOQUE</p>
                           <p class="text-sm">PAM < 65 mmHg ou PAS < 90 mmHg. Iniciar vasopressor (Noradrenalina) com urg√™ncia.</p>
                        </div>
                         <div id="hypertension-alert" class="hidden p-3 mt-2 text-center border-l-4 border-red-500 bg-red-100 rounded-r-lg">
                           <p class="font-bold text-red-800">ALERTA CR√çTICO: CRISE HIPERTENSIVA</p>
                           <p class="text-sm">PAS > 180 mmHg. Risco de les√£o de √≥rg√£o-alvo. Considere vasodilatador EV (ex: Nitroglicerina).</p>
                        </div>
                         <div id="tachycardia-critical-alert" class="hidden p-3 mt-2 text-center border-l-4 border-red-500 bg-red-100 rounded-r-lg">
                           <p class="font-bold text-red-800">ALERTA CR√çTICO: TAQUICARDIA EXTREMA</p>
                           <p class="text-sm">FC > 130 bpm. Risco de instabilidade hemodin√¢mica. Avaliar arritmia e preparar para cardiovers√£o se inst√°vel.</p>
                        </div>
                         <div id="tachycardia-warning-alert" class="hidden p-3 mt-2 text-center border-l-4 border-yellow-500 bg-yellow-100 rounded-r-lg">
                           <p class="font-bold text-yellow-800">ALERTA: TAQUICARDIA</p>
                           <p class="text-sm">FC ‚â• 100 bpm. Investigar e tratar a causa (ex: febre, dor, anemia, arritmia).</p>
                        </div>
                         <div id="perfusion-alert" class="hidden p-3 mt-2 text-center border-l-4 border-red-500 bg-red-100 rounded-r-lg">
                           <p class="font-bold text-red-800">ALERTA: SINAIS DE M√Å PERFUS√ÉO</p>
                           <p class="text-sm">Este √© um sinal de choque. A avalia√ß√£o da Press√£o Arterial √© cr√≠tica.</p>
                        </div>
                         <div id="access-alert" class="p-3 mt-2 text-center border-l-4 border-yellow-500 bg-yellow-100 rounded-r-lg">
                           <p class="font-bold text-yellow-800">LEMBRETE: GARANTA O ACESSO VENOSO</p>
                           <p class="text-sm">O acesso venoso √© crucial para a administra√ß√£o de medicamentos de emerg√™ncia.</p>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="font-bold text-lg">D - Neurol√≥gico</h3>
                    <select id="select-neuro" class="w-full p-2 mt-2 border rounded bg-white">
                        <option value="alerta">Alerta</option>
                        <option value="confuso">Confuso / Sonolento</option>
                        <option value="naoResponsivo">N√£o Responsivo</option>
                    </select>
                    <div id="neuro-confuso-alert" class="hidden p-3 mt-2 text-center border-l-4 border-yellow-500 bg-yellow-100 rounded-r-lg">
                       <p class="font-bold text-yellow-800">ALERTA: N√çVEL DE CONSCI√äNCIA REBAIXADO</p>
                       <p class="text-sm">Pode indicar hipoperfus√£o cerebral ou hipoxemia. Causa deve ser investigada com urg√™ncia.</p>
                    </div>
                    <div id="neuro-naoresponsivo-alert" class="hidden p-3 mt-2 text-center border-l-4 border-red-500 bg-red-100 rounded-r-lg">
                       <p class="font-bold text-red-800">ALERTA CR√çTICO: PACIENTE N√ÉO RESPONSIVO</p>
                       <p class="text-sm">A reavalia√ß√£o da via a√©rea (A) e respira√ß√£o (B) √© imediata. Risco de IOT.</p>
                    </div>
                </div>

                <div>
                    <h3 class="font-bold text-lg">E - Exposi√ß√£o</h3>
                    <div class="space-y-2 mt-2">
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-id="estaseJugular">
                             <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                             <span>Estase jugular patol√≥gica</span>
                        </div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-id="edemaMmii">
                             <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                             <span>Edema de membros inferiores (MMII)</span>
                        </div>
                        <div id="systemic-congestion-alert" class="hidden p-3 mt-2 text-center border-l-4 border-cyan-500 bg-cyan-50 rounded-r-lg">
                           <p class="font-bold text-cyan-800">ALERTA: SINAL DE CONGEST√ÉO SIST√âMICA</p>
                           <p class="text-sm">Este achado sugere sobrecarga de volume e refor√ßa o perfil "√ömido" (congesto).</p>
                        </div>
                    </div>
                </div>
                 <!-- ... resto do ABCDE ... -->
                <button onclick="completeStep('abcde')" class="mt-8 w-full bg-green-500 text-white p-3 rounded-lg font-bold">CONCLUIR AVALIA√á√ÉO E PROSSEGUIR</button>
            </main>
        </div>

        <!-- Tela de Estratificar & Tratar -->
        <div id="estratificar-tratar" class="screen">
             <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üß≠ Definir Perfil do Paciente</h2>
            </header>
            <main class="p-6">
                <div class="mb-6">
                    <h3 class="font-bold text-center text-lg">O paciente est√° CONGESTO ('√ömido')?</h3>
                    <p id="suporte-congestao" class="text-xs text-gray-500 text-center mb-3">Avaliando achados...</p>
                    <div class="flex justify-center space-x-4">
                        <button id="btn-umido-sim" onclick="selectCongestion(true)" class="decision-btn flex-1 p-4 border rounded-lg">üíß SIM</button>
                        <button id="btn-umido-nao" onclick="selectCongestion(false)" class="decision-btn flex-1 p-4 border rounded-lg">‚ö´ N√ÉO</button>
                    </div>
                </div>
                <div class="mb-6">
                    <h3 class="font-bold text-center text-lg">O paciente est√° HIPOPERFUNDIDO ('Frio')?</h3>
                    <p id="suporte-perfusao" class="text-xs text-gray-500 text-center mb-3">Avaliando achados...</p>
                    <div class="flex justify-center space-x-4">
                        <button id="btn-frio-sim" onclick="selectPerfusion(true)" class="decision-btn flex-1 p-4 border rounded-lg">‚ùÑÔ∏è SIM</button>
                        <button id="btn-frio-nao" onclick="selectPerfusion(false)" class="decision-btn flex-1 p-4 border rounded-lg">üî• N√ÉO</button>
                    </div>
                </div>
                
                <div id="perfil-results" class="mt-6 space-y-4">
                    <!-- Perfil A: Quente & Seco -->
                    <div id="perfil-a" class="hidden p-4 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg">
                        <h4 class="font-bold text-blue-800">PERFIL A: QUENTE & SECO</h4>
                        <p class="text-sm mt-2"><strong>Estrat√©gia:</strong> Otimizar terapia oral.</p>
                    </div>
                    <!-- Perfil B: Quente & √ömido -->
                    <div id="perfil-b" class="hidden p-4 border-l-4 border-green-500 bg-green-50 rounded-r-lg">
                        <h4 class="font-bold text-green-800">PERFIL B: QUENTE & √öMIDO</h4>
                        <p class="text-sm mt-2"><strong>Estrat√©gia Prim√°ria:</strong> VASODILATADOR + DIUR√âTICO</p>
                    </div>
                     <!-- Perfil C: Frio & √ömido -->
                    <div id="perfil-c" class="hidden p-4 border-l-4 border-red-500 bg-red-50 rounded-r-lg">
                        <h4 class="font-bold text-red-800">PERFIL C: FRIO & √öMIDO</h4>
                        <p class="text-sm mt-2"><strong>Estrat√©gia Prim√°ria:</strong> INOTR√ìPICO (e VASOPRESSOR se choque)</p>
                    </div>
                    <!-- Perfil L: Frio & Seco -->
                    <div id="perfil-l" class="hidden p-4 border-l-4 border-yellow-500 bg-yellow-50 rounded-r-lg">
                        <h4 class="font-bold text-yellow-800">PERFIL L: FRIO & SECO</h4>
                        <p class="text-sm mt-2"><strong>Estrat√©gia:</strong> Avaliar hipovolemia. Prova de volume cautelosa.</p>
                    </div>
                </div>
                <button onclick="generateActionPlan()" class="mt-8 w-full bg-green-500 text-white p-3 rounded-lg font-bold">GERAR PLANO DE A√á√ÉO</button>
            </main>
        </div>

        <!-- NOVO: Tela Plano de A√ß√£o Imediato -->
        <div id="plano-acao" class="screen">
             <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üìã Plano de A√ß√£o Imediato</h2>
            </header>
            <main class="p-6">
                <div id="acoes-criticas-container" class="mb-6 hidden">
                    <h3 class="font-bold text-lg text-red-600 mb-2 flex items-center"><i class="fas fa-exclamation-triangle mr-2"></i> A√ß√µes Cr√≠ticas Imediatas</h3>
                    <ul id="lista-acoes-criticas" class="space-y-3 bg-red-50 p-4 rounded-lg">
                        <!-- A√ß√µes ser√£o inseridas dinamicamente aqui -->
                    </ul>
                </div>
                
                <div id="estrategia-primaria-container">
                    <h3 class="font-bold text-lg text-blue-600 mb-2 flex items-center"><i class="fas fa-bullseye mr-2"></i> Estrat√©gia Terap√™utica Prim√°ria</h3>
                    <div id="texto-estrategia-primaria" class="bg-blue-50 p-4 rounded-lg text-blue-800">
                        <!-- Estrat√©gia ser√° inserida dinamicamente aqui -->
                    </div>
                </div>
                
                <button id="btn-iniciar-tratamento" onclick="proceedToTherapy()" class="mt-8 w-full bg-green-500 text-white p-3 rounded-lg font-bold">INICIAR TRATAMENTO GUIADO</button>
            </main>
        </div>
        
        <!-- Tela de Calculadora de Drogas -->
        <div id="calculadora-drogas" class="screen">
            <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üíä Centro Terap√™utico</h2>
            </header>
            <main>
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex justify-around" aria-label="Tabs">
                        <button onclick="switchTab('diureticos')" id="tab-diureticos" class="calculator-tab active w-1/4 py-4 px-1 border-b-2 font-medium text-sm" title="Administrar Diur√©ticos">Diur√©ticos</button>
                        <button onclick="switchTab('vasodilatadores')" id="tab-vasodilatadores" class="calculator-tab w-1/4 py-4 px-1 border-b-2 font-medium text-sm text-gray-500" title="Administrar Vasodilatadores">Vasodilatadores</button>
                        <button onclick="switchTab('ino-pressores')" id="tab-ino-pressores" class="calculator-tab w-1/4 py-4 px-1 border-b-2 font-medium text-sm text-gray-500" title="Administrar Drogas Vasoativas">Drogas Vasoativas</button>
                        <button onclick="switchTab('antiarritmicos')" id="tab-antiarritmicos" class="calculator-tab w-1/4 py-4 px-1 border-b-2 font-medium text-sm text-gray-500" title="Manejo de Arritmias">Antiarr√≠tmicos</button>
                    </nav>
                </div>
                
                <div id="content-diureticos" class="p-6">
                    <div id="diureticos-warning" class="hidden mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-500 rounded-r-lg"></div>
                    <h3 class="font-bold text-lg mb-4">Calculadora de Furosemida</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700">Paciente em uso cr√¥nico de diur√©tico?</label>
                        <div class="flex space-x-4 mt-2">
                             <button id="furo-nao" onclick="toggleFurosemidaUso(false)" class="decision-btn selected flex-1 p-2 border rounded-lg text-sm">N√ÉO (Primeiro Uso)</button>
                             <button id="furo-sim" onclick="toggleFurosemidaUso(true)" class="decision-btn flex-1 p-2 border rounded-lg text-sm">SIM (Uso Cr√¥nico)</button>
                        </div>
                    </div>
                    <div id="furosemida-cronico-div" class="hidden mb-4">
                        <label for="dose-oral" class="block text-sm font-medium text-gray-700">Dose oral di√°ria (mg):</label>
                        <input type="number" id="dose-oral" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                    </div>
                    <button onclick="calcularFurosemida()" class="w-full bg-blue-500 text-white p-2 rounded-lg font-bold">CALCULAR DOSE EV</button>
                    <div id="resultado-furosemida" class="mt-4 p-3 bg-green-100 text-green-800 rounded-lg text-center font-semibold hidden"></div>
                    <div class="mt-4 bg-red-50 border border-red-200 p-3 rounded-lg text-sm">
                        <p class="font-bold text-red-700">‚ö†Ô∏è Alerta de Monitoramento Renal</p>
                        <p>Doses elevadas de diur√©ticos de al√ßa podem levar a les√£o renal aguda. Monitore a creatinina e os eletr√≥litos diariamente.</p>
                    </div>
                    <button id="diuretics-next-step-btn" class="mt-6 w-full bg-gray-600 text-white p-3 rounded-lg font-bold">PROSSEGUIR</button>
                </div>

                <div id="content-vasodilatadores" class="p-6 hidden">
                     <div id="vasodilatadores-warning" class="hidden mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-500 rounded-r-lg"></div>
                     <h3 class="font-bold text-lg mb-4">Nitroglicerina (Tridil¬Æ)</h3>
                     <div class="mb-4">
                        <label for="ntg-dose" class="block text-sm font-medium text-gray-700">Dose Desejada (mcg/min):</label>
                        <input type="number" id="ntg-dose" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2" placeholder="Iniciar com 10-20">
                     </div>
                     <button onclick="calcularNitroglicerina()" class="w-full bg-blue-500 text-white p-2 rounded-lg font-bold">CALCULAR INFUS√ÉO</button>
                     <div id="resultado-ntg" class="mt-4 p-3 bg-green-100 text-green-800 rounded-lg hidden"></div>
                     <div class="mt-4 bg-red-50 border border-red-200 p-3 rounded-lg text-sm">
                         <h4 class="font-bold text-red-700">Bloqueio de Seguran√ßa (Contraindica√ß√µes):</h4>
                         <ul class="list-disc list-inside mt-2 space-y-1">
                             <li>PAS < 100 mmHg</li>
                             <li>Uso de Sildenafila (Viagra¬Æ) ou similar nas √∫ltimas 24-48h</li>
                             <li>Estenose A√≥rtica Grave</li>
                         </ul>
                     </div>
                     <button id="vasodilators-next-step-btn" class="mt-6 w-full bg-gray-600 text-white p-3 rounded-lg font-bold">PROSSEGUIR PARA SCORES DE RISCO</button>
                </div>
                
                <div id="content-ino-pressores" class="p-6 hidden">
                     <div id="vasoactives-warning" class="hidden mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-500 rounded-r-lg"></div>
                     <h3 class="font-bold text-lg mb-4">Dobutamina & Noradrenalina</h3>
                     <div class="mb-4 p-3 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
                         <p class="font-bold text-blue-800">Protocolo de Choque ("Pressor First")</p>
                         <p class="text-sm mt-1">Se PAM < 65 mmHg, inicie Noradrenalina PRIMEIRO para estabilizar a PA. Associe Dobutamina AP√ìS estabiliza√ß√£o.</p>
                     </div>
                     <div class="mb-4">
                        <label for="peso-paciente" class="block text-sm font-medium text-gray-700">Peso do paciente (kg):</label>
                        <input type="number" id="peso-paciente" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                    </div>
                    <button onclick="calcularInotropicos()" class="w-full bg-blue-500 text-white p-2 rounded-lg font-bold">CALCULAR INFUS√ÉO</button>
                    <div id="resultado-inotropicos" class="mt-4 p-3 bg-green-100 text-green-800 rounded-lg hidden"></div>
                    <button onclick="showScreen('score-risco')" class="mt-6 w-full bg-gray-600 text-white p-3 rounded-lg font-bold">PROSSEGUIR PARA SCORES DE RISCO</button>
                </div>

                <div id="content-antiarritmicos" class="p-6 hidden">
                    <h3 class="font-bold text-lg mb-4">Manejo de Arritmias (ACLS)</h3>
                     <div class="p-4 bg-red-50 border-l-4 border-red-500 text-red-800 rounded-r-lg">
                        <p class="font-bold">PRIORIDADE: Cardiovers√£o El√©trica</p>
                        <p class="text-sm">Para qualquer taquiarritmia com instabilidade hemodin√¢mica, a cardiovers√£o el√©trica sincronizada √© a terapia de primeira linha.</p>
                    </div>
                    <div class="mt-4 space-y-3">
                        <p class="font-semibold">Checklist de Seguran√ßa para Cardiovers√£o:</p>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Paciente monitorizado e com acesso venoso.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Oxig√™nio dispon√≠vel.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Considerar seda√ß√£o (ex: Midazolam, Etomidato), se paciente consciente.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Ativar modo "SYNC" no desfibrilador.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Selecionar carga apropriada (ex: 100-200 J bif√°sico para FA/TV).</span></div>
                    </div>
                     <button onclick="showScreen('score-risco')" class="mt-6 w-full bg-gray-600 text-white p-3 rounded-lg font-bold">PROSSEGUIR AP√ìS ESTABILIZA√á√ÉO</button>
                </div>
            </main>
        </div>

        <!-- Tela de Investigar Fatores Desencadeantes -->
        <div id="investigar-causa" class="screen">
            <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üîç Investigar Fatores Desencadeantes</h2>
            </header>
            <main class="p-6">
                <p class="text-sm text-gray-500 mb-4 text-center">Selecione os Fatores Desencadeantes para ver a conduta recomendada.</p>
                <div id="checklist-causa" class="space-y-3">
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-target="conduta-sca">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span><span class="font-bold">SCA</span> (S√≠ndrome Coronariana Aguda)?</span>
                    </div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-target="conduta-hipertensao">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span><span class="font-bold">H</span>ipertens√£o n√£o controlada?</span>
                    </div>
                    <!-- M√ìDULO DE ARritmia Aprimorado -->
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-target="conduta-arritmia">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span><span class="font-bold">A</span>rritmia?</span>
                    </div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-target="conduta-adesao">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span><span class="font-bold">M</span>√° ades√£o (rem√©dio/dieta)?</span>
                    </div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-target="conduta-infeccao">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span><span class="font-bold">P</span>neumonia ou outra Infec√ß√£o?</span>
                    </div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center" data-target="conduta-tep">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span><span class="font-bold">O</span>bstru√ß√£o (TEP)?</span>
                    </div>
                </div>

                <div id="condutas-container" class="mt-6 space-y-2">
                    <div id="conduta-sca" class="hidden p-3 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg">
                        <p class="text-sm"><strong>Conduta para SCA:</strong> Solicitar Troponina e ECG seriado. Avaliar antiagrega√ß√£o e anticoagula√ß√£o. Chamar cardiologista.</p>
                        <button onclick="showScreen('score-timi')" class="mt-2 w-full bg-purple-500 text-white p-2 rounded-lg font-bold text-sm">CALCULAR TIMI RISK SCORE</button>
                    </div>
                    <div id="conduta-hipertensao" class="hidden p-3 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg">
                        <p class="text-sm"><strong>Conduta para Hipertens√£o:</strong> Otimizar vasodilatadores (NTG). Considerar anti-hipertensivo oral de a√ß√£o r√°pida (ex: Captopril).</p>
                        <button onclick="goToTherapyTab('vasodilatadores')" class="mt-2 w-full bg-sky-500 text-white p-2 rounded-lg font-bold text-sm">OTIMIZAR VASODILATADORES</button>
                    </div>
                    
                    <!-- NOVO M√ìDULO DE ARritmia -->
                    <div id="conduta-arritmia" class="hidden p-3 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg">
                        <p class="text-sm font-bold mb-3">Selecione a arritmia suspeita para ver a conduta baseada em diretrizes (AHA/ESC):</p>
                        <div class="space-y-2">
                             <button onclick="toggleSubConduta('sub-conduta-fa')" class="w-full text-left p-2 bg-white border rounded-md text-sm font-semibold">Fibrila√ß√£o Atrial (FA) de Alta Resposta</button>
                             <div id="sub-conduta-fa" class="hidden mt-2 p-2 border rounded-md bg-gray-50 text-xs">
                                 <p class="font-bold">Paciente INST√ÅVEL (hipotens√£o, choque, dor isqu√™mica)?</p>
                                 <p class="mb-2 text-red-600">-> Cardiovers√£o El√©trica Sincronizada IMEDIATA.</p>
                                 <p class="font-bold">Paciente EST√ÅVEL?</p>
                                 <p>-> Controle da Frequ√™ncia Card√≠aca: Betabloqueador EV (ex: Metoprolol 5mg) ou Amiodarona EV se disfun√ß√£o ventricular grave.</p>
                             </div>
                             <button onclick="toggleSubConduta('sub-conduta-tv')" class="w-full text-left p-2 bg-white border rounded-md text-sm font-semibold">Taquicardia Ventricular (TV)</button>
                             <div id="sub-conduta-tv" class="hidden mt-2 p-2 border rounded-md bg-gray-50 text-xs">
                                 <p class="font-bold">TV sem pulso?</p>
                                 <p class="mb-2 text-red-600">-> Protocolo de PCR (Desfibrila√ß√£o, massagem, adrenalina).</p>
                                 <p class="font-bold">TV com pulso e INST√ÅVEL?</p>
                                 <p class="mb-2 text-red-600">-> Cardiovers√£o El√©trica Sincronizada.</p>
                                 <p class="font-bold">TV com pulso e EST√ÅVEL?</p>
                                 <p>-> Amiodarona 150mg EV em 10 min. Considerar cardiovers√£o el√©trica eletiva.</p>
                             </div>
                              <button onclick="toggleSubConduta('sub-conduta-bradi')" class="w-full text-left p-2 bg-white border rounded-md text-sm font-semibold">Bradicardia Inst√°vel</button>
                             <div id="sub-conduta-bradi" class="hidden mt-2 p-2 border rounded-md bg-gray-50 text-xs">
                                 <p class="font-bold">Sinais de instabilidade (hipotens√£o, altera√ß√£o neurol√≥gica)?</p>
                                 <p>-> Atropina 1mg EV (pode repetir a cada 3-5 min, m√°x 3mg).</p>
                                 <p>-> Se n√£o houver resposta: Marcapasso Transcut√¢neo de emerg√™ncia.</p>
                             </div>
                        </div>
                    </div>

                    <div id="conduta-adesao" class="hidden p-3 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg"><p class="text-sm"><strong>Conduta para M√° Ades√£o:</strong> Refor√ßar orienta√ß√£o ao paciente e fam√≠lia. Contatar servi√ßo social, se dispon√≠vel.</p></div>
                    <div id="conduta-infeccao" class="hidden p-3 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg"><p class="text-sm"><strong>Conduta para Infec√ß√£o:</strong> Coletar culturas, solicitar Rx de T√≥rax. Iniciar antibi√≥tico emp√≠rico se suspeita alta.</p></div>
                    <div id="conduta-tep" class="hidden p-3 border-l-4 border-blue-500 bg-blue-50 rounded-r-lg"><p class="text-sm"><strong>Conduta para TEP:</strong> Se alta suspeita, considerar AngioTC de t√≥rax. Iniciar anticoagula√ß√£o plena.</p></div>
                </div>

                <button onclick="completeStep('causas'); showScreen('score-risco');" class="mt-8 w-full bg-gray-600 text-white p-3 rounded-lg font-bold">PROSSEGUIR PARA SCORES DE RISCO</button>
            </main>
        </div>

        <!-- Tela de Scores de Risco -->
        <div id="score-risco" class="screen">
            <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üìà Scores de Risco</h2>
            </header>
            <main class="p-6 space-y-4">
                <div class="p-4 rounded-lg bg-blue-50 border border-blue-200">
                    <h3 class="font-bold text-blue-800">Score de Risco GWTG-HF</h3>
                    <p class="text-sm text-gray-600 mt-1">Calcula o risco de mortalidade intra-hospitalar <strong>por Insufici√™ncia Card√≠aca.</strong></p>
                     <p class="text-xs text-center text-gray-500 mt-2">
                        <strong>Nota:</strong> Este score n√£o substitui o julgamento cl√≠nico para agravantes agudos como SCA ou arritmias inst√°veis.
                    </p>
                    <button onclick="showScreen('score-gwtg')" class="mt-2 w-full bg-purple-500 text-white p-2 rounded-lg font-bold text-sm">CALCULAR GWTG-HF SCORE</button>
                </div>
                 <div class="p-4 rounded-lg bg-red-50 border border-red-200">
                    <h3 class="font-bold text-red-800">TIMI Risk Score (SCA)</h3>
                    <p class="text-sm text-gray-600 mt-1">Calcula o risco de eventos isqu√™micos (morte, IAM) em 30 dias para pacientes com <strong>SCA sem supra de ST</strong>.</p>
                    <button onclick="showScreen('score-timi')" class="mt-2 w-full bg-red-500 text-white p-2 rounded-lg font-bold text-sm">CALCULAR TIMI RISK SCORE</button>
                </div>
            </main>
        </div>

        <!-- Tela Score GWTG-HF -->
        <div id="score-gwtg" class="screen">
            <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üìà Score de Risco GWTG-HF</h2>
            </header>
            <main class="p-6 space-y-4">
                <div>
                    <label for="score-idade" class="block text-sm font-medium text-gray-700">Idade (anos)</label>
                    <input type="number" id="score-idade" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                </div>
                 <div>
                    <label for="score-pas" class="block text-sm font-medium text-gray-700">Press√£o Arterial Sist√≥lica (mmHg) <span class="text-blue-500 text-xs">(Preenchido)</span></label>
                    <input type="number" id="score-pas" readonly class="autofill-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                </div>
                <div>
                    <label for="score-fc" class="block text-sm font-medium text-gray-700">Frequ√™ncia Card√≠aca (bpm) <span class="text-blue-500 text-xs">(Preenchido)</span></label>
                    <input type="number" id="score-fc" readonly class="autofill-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                </div>
                 <div>
                    <label for="score-creatinina" class="block text-sm font-medium text-gray-700">Creatinina (mg/dL)</label>
                    <input type="number" id="score-creatinina" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
                </div>
                <button onclick="calcularRiscoGWTG()" class="w-full bg-purple-500 text-white p-3 rounded-lg font-bold">CALCULAR RISCO</button>
                <div id="resultado-risco-gwtg" class="hidden mt-4 p-4 text-center rounded-lg">
                    <h4 class="font-bold text-xl"></h4>
                    <p class="text-sm"></p>
                </div>
                 <button onclick="completeStep('scores'); showScreen('criterios-destino');" class="mt-8 w-full bg-gray-600 text-white p-3 rounded-lg font-bold">PROSSEGUIR PARA ASSESSOR DE DESTINO</button>
            </main>
        </div>

        <!-- TELA SCORE TIMI -->
        <div id="score-timi" class="screen">
             <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üìà TIMI Risk Score (SCA)</h2>
            </header>
            <main class="p-6 space-y-3">
                 <p class="text-sm text-gray-600">Marque os crit√©rios presentes para estratificar o risco de eventos isqu√™micos.</p>
                <div id="checklist-timi">
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Idade ‚â• 65 anos</span></div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>‚â• 3 fatores de risco para DAC (HAS, DM, DLP, Tabagismo, HF)</span></div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>DAC conhecida (estenose > 50%)</span></div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Uso de AAS nos √∫ltimos 7 dias</span></div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Angina grave recente (‚â• 2 epis√≥dios em 24h)</span></div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Desvio do segmento ST ‚â• 0.5 mm</span></div>
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><span>Marcador de necrose mioc√°rdica positivo</span></div>
                </div>
                <button onclick="calcularRiscoTIMI()" class="w-full bg-red-500 text-white p-3 rounded-lg font-bold mt-4">CALCULAR RISCO</button>
                <div id="resultado-risco-timi" class="hidden mt-4 p-4 text-center rounded-lg">
                    <h4 class="font-bold text-xl"></h4>
                    <p class="text-sm"></p>
                </div>
            </main>
        </div>

        <!-- NOVO: Tela de Crit√©rios de Destino -->
        <div id="criterios-destino" class="screen">
            <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">‚û°Ô∏è Assessor de Destino</h2>
            </header>
            <main class="p-6">
                <div id="risco-calculado-display" class="mb-6 p-3 text-center rounded-lg">
                    <!-- Risco calculado ser√° inserido aqui -->
                </div>

                <div class="mb-6">
                    <h3 class="font-bold mb-3">O paciente necessita de alguma das seguintes interven√ß√µes (crit√©rios absolutos para UTI)?</h3>
                    <div id="checklist-destino-uti" class="space-y-3">
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Suporte ventilat√≥rio (IOT ou VNI persistente)</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Uso de drogas vasoativas (Inotr√≥picos, Vasopressores)</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Monitoriza√ß√£o invasiva da PA</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>SCA, arritmia inst√°vel ou hipoxemia refrat√°ria</span></div>
                    </div>
                </div>
                <button onclick="decidirDestino()" class="w-full bg-blue-500 text-white p-3 rounded-lg font-bold">GERAR RECOMENDA√á√ÉO DE DESTINO</button>
                
                <div id="destino-resultado-final" class="hidden mt-6 p-4 text-center border-l-4 rounded-r-lg">
                    <h4 class="font-bold text-xl"></h4>
                    <p class="text-sm"></p>
                </div>
                 <div id="prescription-button-container" class="hidden mt-4">
                    <button onclick="showPrescriptionScreen()" class="w-full bg-green-500 text-white p-3 rounded-lg font-bold"></button>
                </div>
            </main>
        </div>
        
        <!-- NOVO: Tela Otimiza√ß√£o da Prescri√ß√£o -->
        <div id="otimizacao-prescricao" class="screen">
            <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üìù Otimiza√ß√£o da Prescri√ß√£o</h2>
            </header>
            <main class="p-6">
                <!-- Se√ß√£o UTI -->
                <div id="prescricao-uti" class="hidden">
                    <h3 class="font-bold text-lg mb-3 text-red-700">Checklist de Prescri√ß√£o - UTI</h3>
                    <div class="space-y-4">
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Manter DVA (Noradrenalina/Dobutamina) conforme alvo hemodin√¢mico.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Considerar Furosemida em infus√£o cont√≠nua se congest√£o persistente.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Sedoanalgesia se em ventila√ß√£o mec√¢nica (ex: Propofol + Fentanil).</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Profilaxia de TVP (ex: Enoxaparina 40mg SC/dia).</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Profilaxia de √ölcera de Estresse (ex: IBP) se em IOT ou coagulopatia.</span></div>
                    </div>
                </div>
                <!-- Se√ß√£o Enfermaria -->
                <div id="prescricao-enfermaria" class="hidden">
                    <h3 class="font-bold text-lg mb-3 text-blue-700">Checklist de Prescri√ß√£o - Enfermaria</h3>
                    <div class="space-y-4">
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Transi√ß√£o de Furosemida EV para Via Oral.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Iniciar/titular Betabloqueador (ex: Carvedilol, Metoprolol) se est√°vel e euvol√™mico.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Iniciar/titular IECA, BRA ou ARNI.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Iniciar Antagonista Mineralocorticoide (ARM) se K+ e Cr permitirem.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Iniciar iSGLT2 (Dapa/Empagliflozina) durante interna√ß√£o.</span></div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg"><i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i><span>Profilaxia de TVP (ex: Enoxaparina 40mg SC/dia).</span></div>
                    </div>
                </div>
            </main>
        </div>
        
        <!-- NOVO: Tela Otimiza√ß√£o de Alta -->
        <div id="otimizacao-alta" class="screen">
            <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">‚≠ê Checklist de Alta (GDMT)</h2>
            </header>
            <main class="p-6">
                <div class="mb-6 p-3 bg-blue-50 border-l-4 border-blue-500 rounded-r-lg">
                    <h3 class="font-bold text-blue-800">Alerta de In√≠cio de iSGLT2</h3>
                    <p class="text-sm mt-1">Evid√™ncias robustas recomendam iniciar um <strong>iSGLT2</strong> (Dapa/Empagliflozina) durante a hospitaliza√ß√£o, assim que o paciente estiver euvol√™mico. Considere iniciar a terapia.</p>
                </div>
                <h3 class="font-bold text-lg mb-3">Checklist dos 4 Pilares (ICFEr)</h3>
                <p class="text-sm text-gray-600 mb-4">O paciente est√° recebendo alta com todas as terapias abaixo?</p>
                <div class="space-y-4">
                    <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span>ARNI / IECA / BRA</span>
                    </div>
                     <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span>Betabloqueador</span>
                    </div>
                    <div>
                        <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center">
                            <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                            <span>Antagonista Mineralocorticoide (ARM)</span>
                        </div>
                        <div class="mt-2 text-xs bg-red-50 border border-red-200 p-2 rounded-lg">
                           <p>‚ö†Ô∏è **Verifique K+ e Creatinina!** N√£o inicie ARM se K+ > 5.0 ou TFG < 30. Monitore em 3-7 dias.</p>
                        </div>
                    </div>
                     <div class="checklist-item bg-gray-50 border p-3 rounded-lg flex items-center">
                        <i class="far fa-square mr-3"></i><i class="fas fa-check-square mr-3 hidden"></i>
                        <span>Inibidor de SGLT2 (iSGLT2)</span>
                    </div>
                </div>
            </main>
        </div>

        <!-- NOVO: Tela de Refer√™ncias -->
        <div id="referencias" class="screen">
            <header class="bg-gray-800 text-white p-4 flex items-center">
                <button onclick="showScreen('dashboard')" class="text-xl mr-4"><i class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-semibold">üìö Refer√™ncias Cient√≠ficas</h2>
            </header>
            <main class="p-6 space-y-4 text-sm">
                <p class="text-gray-600">A l√≥gica cl√≠nica deste aplicativo √© fundamentada nas seguintes diretrizes e publica√ß√µes de alto impacto:</p>
                <div class="p-3 bg-gray-50 rounded-lg border">
                    <h3 class="font-bold">Diretrizes Principais</h3>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li><strong>AHA/ACC/HFSA Guideline for the Management of Heart Failure</strong> (2022)</li>
                        <li><strong>ESC Guidelines for the diagnosis and treatment of acute and chronic heart failure</strong> (2021)</li>
                        <li><strong>AHA Advanced Cardiovascular Life Support (ACLS) Provider Manual</strong></li>
                        <li><strong>Diretriz Brasileira de Insufici√™ncia Card√≠aca Cr√¥nica e Aguda</strong> (2018)</li>
                    </ul>
                </div>
                 <div class="p-3 bg-gray-50 rounded-lg border">
                    <h3 class="font-bold">Livros-Texto de Refer√™ncia</h3>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>Braunwald's Heart Disease: A Textbook of Cardiovascular Medicine</li>
                        <li>Harrison's Principles of Internal Medicine</li>
                    </ul>
                </div>
                <div class="p-3 bg-gray-50 rounded-lg border">
                    <h3 class="font-bold">Publica√ß√µes de Alto Impacto (Exemplos)</h3>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li><strong>DAPA-HF Trial:</strong> Dapagliflozin in Patients with Heart Failure and Reduced Ejection Fraction. (NEJM, 2019)</li>
                         <li><strong>EMPEROR-Reduced Trial:</strong> Empagliflozin in Patients with Chronic Heart Failure and a Reduced Ejection Fraction. (NEJM, 2020)</li>
                        <li><strong>GWTG-HF Risk Score Validation:</strong> A validated risk model for in-hospital mortality in patients with heart failure. (Arch Intern Med, 2007)</li>
                    </ul>
                </div>
            </main>
        </div>

    </div>

    <!-- Modais e Scripts -->
    <script>
        // --- State Management ---
        const patientState = {
            checklist: {},
            fr: null,
            spo2: null,
            fc: null,
            pas: null,
            pam: null,
            estadoNeurologico: 'alerta',
            riscoGWTG: null, // 'Baixo', 'Intermedi√°rio', 'Alto'
            destinoFinal: null, // 'UTI', 'Enfermaria'
            isHypertensiveCrisis: false,
            unstableTachycardia: false,
            // NOVO: Controle de fluxo do dashboard
            stepsCompleted: {
                abcde: false,
                perfil: false,
                terapia: false,
                causas: false,
                scores: false,
                destino: false,
                prescricao: false
            }
        };
        
        let estadoCongestao = null;
        let estadoPerfusao = null;
        let determinedProfile = null;
        let usoCronicoFurosemida = false;

        // --- Navega√ß√£o ---
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            window.scrollTo(0, 0);

            if (screenId === 'estratificar-tratar') {
                atualizarSuporteVisual();
            }
            if (screenId === 'score-gwtg') {
                populateScoreFields();
            }
            if (screenId === 'criterios-destino') {
                displayCalculatedRisk();
            }
        }

        function completeStep(step) {
            if (patientState.stepsCompleted.hasOwnProperty(step)) {
                patientState.stepsCompleted[step] = true;
                updateDashboardUI();
            }
            const nextScreenMap = {
                'abcde': 'estratificar-tratar'
            };
            if (nextScreenMap[step]) {
                showScreen(nextScreenMap[step]);
            }
        }

        function updateDashboardUI() {
            const steps = patientState.stepsCompleted;
            document.getElementById('btn-dashboard-perfil').disabled = !steps.abcde;
            document.getElementById('btn-dashboard-terapia').disabled = !steps.perfil;
            document.getElementById('btn-dashboard-scores').disabled = !steps.terapia; // Note: Scores can be accessed after therapy
            document.getElementById('btn-dashboard-causas').disabled = !steps.scores;
            document.getElementById('btn-dashboard-destino').disabled = !steps.causas;
            document.getElementById('btn-dashboard-prescricao').disabled = !steps.destino;

            const altaButton = document.getElementById('btn-dashboard-alta');
            if (patientState.destinoFinal === 'UTI') {
                altaButton.disabled = true;
                altaButton.title = "Checklist de Alta n√£o aplic√°vel para pacientes com destino √† UTI.";
            } else {
                 altaButton.disabled = !steps.prescricao;
                 altaButton.title = "Checklist para o momento da alta hospitalar.";
            }
        }


        function displayCalculatedRisk() {
            const displayDiv = document.getElementById('risco-calculado-display');
            if (patientState.riscoGWTG) {
                let bgColor = 'bg-gray-100';
                let textColor = 'text-gray-800';
                if (patientState.riscoGWTG === 'Alto') {
                    bgColor = 'bg-red-100';
                    textColor = 'text-red-800';
                } else if (patientState.riscoGWTG === 'Intermedi√°rio') {
                    bgColor = 'bg-yellow-100';
                    textColor = 'text-yellow-800';
                } else if (patientState.riscoGWTG === 'Baixo') {
                    bgColor = 'bg-green-100';
                    textColor = 'text-green-800';
                }
                displayDiv.className = `mb-6 p-3 text-center rounded-lg ${bgColor} ${textColor}`;
                displayDiv.innerHTML = `<p class="font-semibold">Risco GWTG-HF Calculado: <strong class="uppercase">${patientState.riscoGWTG}</strong></p>`;
            } else {
                 displayDiv.className = 'mb-6 p-3 text-center rounded-lg bg-gray-100 text-gray-800';
                 displayDiv.innerHTML = '<p>Score de risco ainda n√£o calculado.</p>';
            }
        }

        function populateScoreFields() {
            const pasInput = document.getElementById('score-pas');
            const fcInput = document.getElementById('score-fc');

            if (patientState.pas) {
                pasInput.value = patientState.pas;
            }
            if (patientState.fc) {
                fcInput.value = patientState.fc;
            }
        }

        function atualizarSuporteVisual() {
            const suporteCongestao = document.getElementById('suporte-congestao');
            const suportePerfusao = document.getElementById('suporte-perfusao');
            
            let achadosCongestao = [];
            if (patientState.checklist['estertores']) achadosCongestao.push('Estertores');
            if (patientState.checklist['estaseJugular']) achadosCongestao.push('Estase Jugular');
            if (patientState.checklist['edemaMmii']) achadosCongestao.push('Edema MMII');

            if (achadosCongestao.length > 0) {
                suporteCongestao.textContent = 'Achados de suporte: ' + achadosCongestao.join(', ');
            } else {
                suporteCongestao.textContent = 'Nenhum sinal de congest√£o selecionado na avalia√ß√£o.';
            }

            let achadosPerfusao = [];
            if (patientState.checklist['peleFria']) achadosPerfusao.push('Pele Fria');
            if ((patientState.pam && patientState.pam < 65) || (patientState.pas && patientState.pas < 90)) achadosPerfusao.push('Hipotens√£o');
            if (patientState.estadoNeurologico === 'confuso' || patientState.estadoNeurologico === 'naoResponsivo') achadosPerfusao.push('Altera√ß√£o Neurol√≥gica');

            if (achadosPerfusao.length > 0) {
                suportePerfusao.textContent = 'Achados de suporte: ' + achadosPerfusao.join(', ');
            } else {
                suportePerfusao.textContent = 'Nenhum sinal de m√° perfus√£o selecionado na avalia√ß√£o.';
            }
        }


        // --- Event Listeners para Inputs ---
        document.getElementById('input-fr').addEventListener('input', (e) => {
            patientState.fr = e.target.value;
            checkRespiratoryAlerts();
        });
        document.getElementById('input-spo2').addEventListener('input', (e) => {
            patientState.spo2 = e.target.value;
            checkRespiratoryAlerts();
        });
        document.getElementById('input-fc').addEventListener('input', (e) => {
            patientState.fc = e.target.value;
            checkCirculationAlerts();
        });
        document.getElementById('input-pas').addEventListener('input', (e) => {
             patientState.pas = e.target.value;
             checkCirculationAlerts();
        });
        document.getElementById('input-pam').addEventListener('input', (e) => {
            patientState.pam = e.target.value;
            checkCirculationAlerts();
        });
        document.getElementById('select-neuro').addEventListener('change', (e) => {
            patientState.estadoNeurologico = e.target.value;
            checkNeuroAlert();
            checkRespiratoryAlerts(); // Re-check respiratory status if neuro state changes
        });


        function selectCongestion(isUmido) {
            estadoCongestao = isUmido;
            document.getElementById('btn-umido-sim').classList.toggle('selected', isUmido);
            document.getElementById('btn-umido-nao').classList.toggle('selected', !isUmido);
            avaliarPerfil();
        }

        function selectPerfusion(isFrio) {
            estadoPerfusao = isFrio;
            document.getElementById('btn-frio-sim').classList.toggle('selected', isFrio);
            document.getElementById('btn-frio-nao').classList.toggle('selected', !isFrio);
            avaliarPerfil();
        }

        function avaliarPerfil() {
            if (estadoCongestao === null || estadoPerfusao === null) return;

            document.getElementById('perfil-a').classList.add('hidden');
            document.getElementById('perfil-b').classList.add('hidden');
            document.getElementById('perfil-c').classList.add('hidden');
            document.getElementById('perfil-l').classList.add('hidden');

            if (!estadoPerfusao && !estadoCongestao) { // Quente e Seco
                document.getElementById('perfil-a').classList.remove('hidden');
                determinedProfile = 'A';
            } else if (!estadoPerfusao && estadoCongestao) { // Quente e √ömido
                document.getElementById('perfil-b').classList.remove('hidden');
                determinedProfile = 'B';
            } else if (estadoPerfusao && estadoCongestao) { // Frio e √ömido
                document.getElementById('perfil-c').classList.remove('hidden');
                determinedProfile = 'C';
            } else if (estadoPerfusao && !estadoCongestao) { // Frio e Seco
                document.getElementById('perfil-l').classList.remove('hidden');
                determinedProfile = 'L';
            }
            patientState.stepsCompleted.perfil = true;
            updateDashboardUI();
        }

        // NOVA L√ìGICA: Gera o plano de a√ß√£o consolidado
        function generateActionPlan() {
            if (determinedProfile === null) {
                alert("Por favor, defina o perfil do paciente primeiro.");
                return;
            }

            const acoesContainer = document.getElementById('acoes-criticas-container');
            const listaAcoes = document.getElementById('lista-acoes-criticas');
            const estrategiaContainer = document.getElementById('texto-estrategia-primaria');
            const therapyButton = document.getElementById('btn-iniciar-tratamento');

            listaAcoes.innerHTML = '';
            estrategiaContainer.innerHTML = '';

            let hasCriticalActions = false;
            patientState.unstableTachycardia = false; // Reset
            
            const isShocked = (patientState.pas && patientState.pas < 90) || (patientState.pam && patientState.pam < 65);
            const isExtremeTachy = patientState.fc && patientState.fc > 130;

            // Define a prioridade e a l√≥gica das a√ß√µes cr√≠ticas
            const addAction = (text) => {
                listaAcoes.innerHTML += `<li class="text-red-700">${text}</li>`;
                hasCriticalActions = true;
            };

            if (!patientState.checklist['viasAereas']) {
                addAction('<p><strong class="font-bold">PRIORIDADE 1: VIA A√âREA.</strong> Prepare para manejo avan√ßado (IOT).</p>');
            }
            
            // ACLS Logic: Tachycardia causing instability
            if (isExtremeTachy && isShocked) {
                addAction('<p><strong class="font-bold">PRIORIDADE 1: TAQUICARDIA INST√ÅVEL.</strong> A arritmia √© a prov√°vel causa do choque. Prepare para <strong>Cardiovers√£o El√©trica Sincronizada</strong> imediata.</p>');
                patientState.unstableTachycardia = true;
            } else if (isShocked) {
                addAction('<p><strong class="font-bold">PRIORIDADE 1: CHOQUE.</strong> Inicie Vasopressor (Noradrenalina) para estabilizar PAM > 65mmHg.</p>');
            } else if (patientState.isHypertensiveCrisis) {
                addAction('<p><strong class="font-bold">PRIORIDADE 1: CRISE HIPERTENSIVA.</strong> Inicie vasodilatador EV (ex: Nitroglicerina) para controle press√≥rico.</p>');
            } else if (patientState.checklist['peleFria']) {
                 addAction('<p><strong class="font-bold">M√Å PERFUS√ÉO.</strong> Reavalie a press√£o arterial continuamente.</p>');
            }

            // L√≥gica respirat√≥ria consolidada
            const { critical, warning } = getRespiratoryStatus();
            if (critical) {
                addAction('<p><strong class="font-bold">FAL√äNCIA RESPIRAT√ìRIA.</strong> Prepare para IOT e inicie VNI como ponte, se poss√≠vel.</p>');
            } else if (warning) {
                addAction('<p><strong class="font-bold">INSUFICI√äNCIA RESPIRAT√ìRIA.</strong> Inicie VNI (CPAP/BiPAP) para suporte ventilat√≥rio.</p>');
            }

            if (patientState.estadoNeurologico === 'naoResponsivo') {
                addAction('<p><strong class="font-bold">PACIENTE N√ÉO RESPONSIVO.</strong> Reavalie via a√©rea (A) e respira√ß√£o (B) imediatamente. Alto risco de IOT.</p>');
            } else if (patientState.estadoNeurologico === 'confuso' && (isShocked || critical)) {
                addAction('<p><strong class="font-bold">REBAIXAMENTO NEUROL√ìGICO</strong> secund√°rio √† instabilidade hemodin√¢mica/respirat√≥ria.</p>');
            } else if (patientState.estadoNeurologico === 'confuso') {
                 addAction('<p><strong class="font-bold">REBAIXAMENTO NEUROL√ìGICO.</strong> Investigue a causa prim√°ria (ex: dist√∫rbio metab√≥lico).</p>');
            }


            if (hasCriticalActions) {
                acoesContainer.classList.remove('hidden');
            } else {
                acoesContainer.classList.add('hidden');
            }

            // Define a estrat√©gia prim√°ria
            let estrategiaHTML = '';
            switch (determinedProfile) {
                case 'A':
                    estrategiaHTML = `<p class="font-bold">Perfil A (Quente & Seco):</p><p>Otimizar terapia oral. Nenhum tratamento EV agudo √© tipicamente necess√°rio.</p>`;
                    break;
                case 'B':
                    estrategiaHTML = `<p class="font-bold">Perfil B (Quente & √ömido):</p><p>A terapia se concentrar√° em <strong>Vasodilatadores e Diur√©ticos</strong> para aliviar a congest√£o.</p>`;
                    break;
                case 'C':
                    estrategiaHTML = `<p class="font-bold">Perfil C (Frio & √ömido):</p><p>A prioridade √© melhorar a perfus√£o com <strong>Drogas Vasoativas (Inotr√≥picos e/ou Vasopressores)</strong>.</p>`;
                    break;
                case 'L':
                    estrategiaHTML = `<p class="font-bold">Perfil L (Frio & Seco):</p><p>Avaliar causa da hipoperfus√£o. Considerar prova de volume com cautela.</p>`;
                    break;
            }
            estrategiaContainer.innerHTML = estrategiaHTML;
            
            // Modifica o bot√£o com base no perfil
            if (determinedProfile === 'A' || determinedProfile === 'L') {
                therapyButton.textContent = 'CONCLUIR ETAPA';
                therapyButton.onclick = () => {
                    patientState.stepsCompleted.terapia = true;
                    showScreen('score-risco');
                    updateDashboardUI();
                }
            } else {
                therapyButton.textContent = 'INICIAR TRATAMENTO GUIADO';
                therapyButton.onclick = proceedToTherapy; 
            }
            
            showScreen('plano-acao');
        }

        // Navega√ß√£o para o tratamento guiado
        function proceedToTherapy(fromDashboard = false) {
            patientState.stepsCompleted.terapia = true;
            updateDashboardUI();

            if (!determinedProfile && !fromDashboard) {
                alert("Perfil n√£o definido. Retornando ao in√≠cio.");
                showScreen('dashboard');
                return;
            }

            if (patientState.unstableTachycardia) {
                updateTherapyTabsUI('TACHYCARDIA');
                showScreen('calculadora-drogas');
                switchTab('antiarritmicos');
                return;
            }
            
            if (fromDashboard && !determinedProfile) {
                updateTherapyTabsUI('DEFAULT'); // Habilita todas as abas
                showScreen('calculadora-drogas');
                return;
            }

            updateTherapyTabsUI(determinedProfile);

            const diureticsBtn = document.getElementById('diuretics-next-step-btn');
            const vasodilatorsBtn = document.getElementById('vasodilators-next-step-btn');
            const defaultNext = () => {
                completeStep('terapia');
                showScreen('score-risco');
            };

            diureticsBtn.textContent = "PROSSEGUIR PARA SCORES DE RISCO";
            diureticsBtn.onclick = defaultNext;
            vasodilatorsBtn.textContent = "PROSSEGUIR PARA SCORES DE RISCO";
            vasodilatorsBtn.onclick = defaultNext;
            
            if (determinedProfile === 'B') {
                diureticsBtn.textContent = "PROSSEGUIR PARA VASODILATADORES";
                diureticsBtn.onclick = () => switchTab('vasodilatadores');
            }

            showScreen('calculadora-drogas');
            switch (determinedProfile) {
                case 'B': switchTab('diureticos'); break;
                case 'C': switchTab('ino-pressores'); break;
                default: switchTab('diureticos'); break;
            }
        }
        
        // NOVA L√ìGICA: Adapta a UI do Centro Terap√™utico
        function updateTherapyTabsUI(profile) {
            const allTabs = ['diureticos', 'vasodilatadores', 'ino-pressores', 'antiarritmicos'].map(id => document.getElementById(`tab-${id}`));
            
            allTabs.forEach(tab => tab.classList.remove('disabled-tab'));

            switch(profile) {
                case 'A':
                    allTabs.forEach(tab => tab.classList.add('disabled-tab'));
                    break;
                case 'B':
                    allTabs[2].classList.add('disabled-tab'); // Ino-pressores
                    allTabs[3].classList.add('disabled-tab'); // Antiarritmicos
                    break;
                case 'C':
                case 'L':
                    allTabs[0].classList.add('disabled-tab'); // Diureticos
                    allTabs[1].classList.add('disabled-tab'); // Vasodilatadores
                    allTabs[3].classList.add('disabled-tab'); // Antiarritmicos
                    break;
                case 'TACHYCARDIA':
                     allTabs[0].classList.add('disabled-tab');
                     allTabs[1].classList.add('disabled-tab');
                     allTabs[2].classList.add('disabled-tab');
                    break;
                case 'DEFAULT': // Acesso pelo dashboard
                    break;
            }
        }
        
        <!-- L√ìGICA RESPIRAT√ìRIA REVISADA E CORRIGIDA -->
        function getRespiratoryStatus() {
            const fr = parseInt(patientState.fr);
            const spo2 = parseInt(patientState.spo2);
            const musculatura = patientState.checklist['musculaturaAcessoria'];
            const neuro = patientState.estadoNeurologico;

            const taquipneia = fr >= 24; 
            const hipoxemiaLeve = spo2 < 92;
            const usoMusculatura = musculatura;

            const sinaisDeDesconfortoCount = (taquipneia ? 1 : 0) + (hipoxemiaLeve ? 1 : 0) + (usoMusculatura ? 1 : 0);

            const isCritical = 
                (spo2 < 90) || 
                (fr > 35) || 
                ((neuro !== 'alerta') && (taquipneia || hipoxemiaLeve || usoMusculatura)) || 
                (sinaisDeDesconfortoCount >= 2); 

            const isWarning = !isCritical && (sinaisDeDesconfortoCount === 1);

            return { critical: isCritical, warning: isWarning };
        }

        function checkRespiratoryAlerts() {
            const vniAlert = document.getElementById('vni-alert');
            const iotAlert = document.getElementById('iot-alert');
            
            const { critical, warning } = getRespiratoryStatus();

            if (critical) {
                iotAlert.classList.remove('hidden');
                vniAlert.classList.add('hidden');
            } else {
                iotAlert.classList.add('hidden');
                vniAlert.classList.toggle('hidden', !warning);
            }
        }

        function checkCirculationAlerts() {
            const fc = parseInt(patientState.fc);
            const pas = parseInt(patientState.pas);
            const pam = parseInt(patientState.pam);

            const hypotensionAlert = document.getElementById('hypotension-alert');
            const hypertensionAlert = document.getElementById('hypertension-alert');
            const tachyWarningAlert = document.getElementById('tachycardia-warning-alert');
            const tachyCriticalAlert = document.getElementById('tachycardia-critical-alert');
            
            hypotensionAlert.classList.add('hidden');
            hypertensionAlert.classList.add('hidden');
            tachyWarningAlert.classList.add('hidden');
            tachyCriticalAlert.classList.add('hidden');
            patientState.isHypertensiveCrisis = false;

            if (pas < 90 || pam < 65) {
                hypotensionAlert.classList.remove('hidden');
            } else if (pas > 180) {
                hypertensionAlert.classList.remove('hidden');
                patientState.isHypertensiveCrisis = true;
            }

            if (fc > 130) {
                tachyCriticalAlert.classList.remove('hidden');
            } else if (fc >= 100) {
                tachyWarningAlert.classList.remove('hidden');
            }
        }
        
        function checkPerfusionAlert() {
            const perfusionAlert = document.getElementById('perfusion-alert');
            if (patientState.checklist['peleFria']) {
                perfusionAlert.classList.remove('hidden');
            } else {
                perfusionAlert.classList.add('hidden');
            }
        }
        
        function checkCongestionAlert() {
            const congestionAlert = document.getElementById('congestion-alert');
            if (patientState.checklist['estertores']) {
                congestionAlert.classList.remove('hidden');
            } else {
                congestionAlert.classList.add('hidden');
            }
        }
        
        function checkAirwayAlert() {
            const airwayAlert = document.getElementById('airway-alert');
            if (!patientState.checklist['viasAereas']) {
                airwayAlert.classList.remove('hidden');
            } else {
                airwayAlert.classList.add('hidden');
            }
        }
        
        function checkAccessAlert() {
            const accessAlert = document.getElementById('access-alert');
            if (patientState.checklist['acessosVenosos']) {
                accessAlert.classList.add('hidden');
            } else {
                accessAlert.classList.remove('hidden');
            }
        }
        
        function checkNeuroAlert() {
            const estado = patientState.estadoNeurologico;
            const confusoAlert = document.getElementById('neuro-confuso-alert');
            const naoResponsivoAlert = document.getElementById('neuro-naoresponsivo-alert');

            confusoAlert.classList.add('hidden');
            naoResponsivoAlert.classList.add('hidden');

            if (estado === 'confuso') {
                confusoAlert.classList.remove('hidden');
            } else if (estado === 'naoResponsivo') {
                naoResponsivoAlert.classList.remove('hidden');
            }
        }
        
        function checkSystemicCongestionAlert() {
            const systemicCongestionAlert = document.getElementById('systemic-congestion-alert');
            if (patientState.checklist['estaseJugular'] || patientState.checklist['edemaMmii']) {
                systemicCongestionAlert.classList.remove('hidden');
            } else {
                systemicCongestionAlert.classList.add('hidden');
            }
        }
        
        // --- Checklists Interativos ---
        document.querySelectorAll('.checklist-item').forEach(item => {
            item.addEventListener('click', () => {
                item.classList.toggle('checked');
                const squareIcon = item.querySelector('.fa-square');
                const checkIcon = item.querySelector('.fa-check-square');
                if (squareIcon && checkIcon) {
                   squareIcon.classList.toggle('hidden');
                   checkIcon.classList.toggle('hidden');
                }
                const dataId = item.getAttribute('data-id');
                if(dataId){
                    patientState.checklist[dataId] = item.classList.contains('checked');
                }
                if (dataId === 'viasAereas') checkAirwayAlert();
                if (dataId === 'musculaturaAcessoria') checkRespiratoryAlerts();
                if (dataId === 'peleFria') checkPerfusionAlert();
                if (dataId === 'estertores') checkCongestionAlert();
                if (dataId === 'acessosVenosos') checkAccessAlert();
                if (dataId === 'estaseJugular' || dataId === 'edemaMmii') checkSystemicCongestionAlert();
                
                // L√≥gica para checklist da causa
                const targetId = item.getAttribute('data-target');
                if (targetId) {
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.classList.toggle('hidden', !item.classList.contains('checked'));
                    }
                }
            });
        });

        function toggleSubConduta(subCondutaId) {
            const subCondutaElement = document.getElementById(subCondutaId);
            if (subCondutaElement) {
                // Opcional: Esconder outras sub-condutas abertas para uma UI mais limpa
                const allSubCondutas = document.querySelectorAll('[id^="sub-conduta-"]');
                allSubCondutas.forEach(el => {
                    if (el.id !== subCondutaId) {
                        el.classList.add('hidden');
                    }
                });
                subCondutaElement.classList.toggle('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            patientState.checklist['viasAereas'] = false;
            checkAirwayAlert();
            patientState.checklist['acessosVenosos'] = false;
            checkAccessAlert();
            updateDashboardUI();
        });

        function calcularRiscoGWTG() {
            const idade = parseInt(document.getElementById('score-idade').value) || 0;
            const pas = parseInt(document.getElementById('score-pas').value) || 0;
            const fc = parseInt(document.getElementById('score-fc').value) || 0;
            const creatinina = parseFloat(document.getElementById('score-creatinina').value) || 0;
            
            let score = 0;
            if (idade > 75) score += 2;
            if (pas < 120) score += 2;
            if (fc > 100) score += 1;
            if (creatinina > 2.0) score += 2;

            const resultadoDiv = document.getElementById('resultado-risco-gwtg'); // Corrigido
            const titulo = resultadoDiv.querySelector('h4');
            const texto = resultadoDiv.querySelector('p');
            
            resultadoDiv.classList.remove('hidden');

            if (score <= 2) {
                resultadoDiv.className = 'mt-4 p-4 text-center rounded-lg bg-green-100 text-green-800';
                titulo.textContent = 'Risco Baixo';
                texto.textContent = 'Mortalidade intra-hospitalar estimada < 2%';
                patientState.riscoGWTG = 'Baixo';
            } else if (score <= 4) {
                resultadoDiv.className = 'mt-4 p-4 text-center rounded-lg bg-yellow-100 text-yellow-800';
                titulo.textContent = 'Risco Intermedi√°rio';
                texto.textContent = 'Mortalidade intra-hospitalar estimada entre 2% e 5%';
                patientState.riscoGWTG = 'Intermedi√°rio';
            } else {
                resultadoDiv.className = 'mt-4 p-4 text-center rounded-lg bg-red-100 text-red-800';
                titulo.textContent = 'Risco Alto';
                texto.textContent = 'Mortalidade intra-hospitalar estimada > 5%';
                patientState.riscoGWTG = 'Alto';
            }
             patientState.stepsCompleted.scores = true;
            updateDashboardUI();
        }

        function calcularRiscoTIMI() {
            const checklist = document.getElementById('checklist-timi');
            const itemsChecked = checklist.querySelectorAll('.checklist-item.checked').length;

            const resultadoDiv = document.getElementById('resultado-risco-timi');
            const titulo = resultadoDiv.querySelector('h4');
            const texto = resultadoDiv.querySelector('p');
            resultadoDiv.classList.remove('hidden');

            let riskLevel = '';
            let riskText = '';

            if (itemsChecked <= 1) {
                riskLevel = 'Baixo Risco';
                riskText = `Risco de eventos (Morte, IAM, revasculariza√ß√£o): ~5%`;
                resultadoDiv.className = 'mt-4 p-4 text-center rounded-lg bg-green-100 text-green-800';
            } else if (itemsChecked <= 2) {
                riskLevel = 'Risco Intermedi√°rio';
                riskText = `Risco de eventos: ~8%`;
                 resultadoDiv.className = 'mt-4 p-4 text-center rounded-lg bg-yellow-100 text-yellow-800';
            } else if (itemsChecked <= 4) {
                 riskLevel = 'Alto Risco';
                riskText = `Risco de eventos: 13-20%`;
                 resultadoDiv.className = 'mt-4 p-4 text-center rounded-lg bg-orange-100 text-orange-800';
            } else {
                riskLevel = 'Muito Alto Risco';
                riskText = `Risco de eventos: >26%`;
                 resultadoDiv.className = 'mt-4 p-4 text-center rounded-lg bg-red-100 text-red-800';
            }

            titulo.textContent = `${riskLevel} (Score: ${itemsChecked})`;
            texto.textContent = riskText;
        }

        function decidirDestino() {
            const checklist = document.getElementById('checklist-destino-uti');
            const itemsChecked = checklist.querySelectorAll('.checklist-item.checked').length > 0;
            const resultadoFinal = document.getElementById('destino-resultado-final');
            const prescriptionButtonContainer = document.getElementById('prescription-button-container');
            const prescriptionButton = prescriptionButtonContainer.querySelector('button');

            const titulo = resultadoFinal.querySelector('h4');
            const texto = resultadoFinal.querySelector('p');

            resultadoFinal.className = 'hidden mt-6 p-4 text-center border-l-4 rounded-r-lg'; // Reset classes
            prescriptionButtonContainer.classList.add('hidden');
            patientState.destinoFinal = null;

            if (itemsChecked) {
                resultadoFinal.classList.add('border-red-500', 'bg-red-100');
                titulo.className = 'font-bold text-xl text-red-800';
                titulo.textContent = 'Recomenda√ß√£o: UTI';
                texto.textContent = 'Paciente preenche crit√©rios absolutos para terapia intensiva.';
                patientState.destinoFinal = 'UTI';
            } else {
                switch(patientState.riscoGWTG) {
                    case 'Alto':
                        resultadoFinal.classList.add('border-red-500', 'bg-red-100');
                        titulo.className = 'font-bold text-xl text-red-800';
                        titulo.textContent = 'Recomenda√ß√£o: UTI ou Unidade Intermedi√°ria';
                        texto.textContent = 'Apesar da estabilidade aparente, o alto risco de mortalidade justifica monitoriza√ß√£o intensiva.';
                        patientState.destinoFinal = 'UTI';
                        break;
                    case 'Intermedi√°rio':
                        resultadoFinal.classList.add('border-yellow-500', 'bg-yellow-100');
                        titulo.className = 'font-bold text-xl text-yellow-800';
                        titulo.textContent = 'Recomenda√ß√£o: ENFERMARIA';
                        texto.textContent = 'Paciente necessita de interna√ß√£o para otimiza√ß√£o terap√™utica e monitoriza√ß√£o.';
                         patientState.destinoFinal = 'Enfermaria';
                        break;
                    case 'Baixo':
                         resultadoFinal.classList.add('border-green-500', 'bg-green-100');
                        titulo.className = 'font-bold text-xl text-green-800';
                        titulo.textContent = 'Recomenda√ß√£o: ENFERMARIA';
                        texto.textContent = 'Considerar alta precoce ap√≥s otimiza√ß√£o inicial, a crit√©rio m√©dico.';
                         patientState.destinoFinal = 'Enfermaria';
                        break;
                    default:
                        resultadoFinal.classList.add('border-gray-500', 'bg-gray-100');
                        titulo.className = 'font-bold text-xl text-gray-800';
                        titulo.textContent = 'Recomenda√ß√£o Pendente';
                        texto.textContent = 'Calcule o Score de Risco GWTG-HF para refinar a decis√£o de destino.';
                }
            }
            if (patientState.destinoFinal) {
                prescriptionButton.textContent = `OTIMIZAR PRESCRI√á√ÉO PARA ${patientState.destinoFinal.toUpperCase()}`;
                prescriptionButtonContainer.classList.remove('hidden');
                patientState.stepsCompleted.destino = true;
                updateDashboardUI();
            }
            resultadoFinal.classList.remove('hidden');
        }

        function showPrescriptionScreen() {
            const destino = patientState.destinoFinal;
            if (!destino) return;

            const prescUTI = document.getElementById('prescricao-uti');
            const prescEnfermaria = document.getElementById('prescricao-enfermaria');

            prescUTI.classList.add('hidden');
            prescEnfermaria.classList.add('hidden');

            if (destino === 'UTI') {
                prescUTI.classList.remove('hidden');
            } else if (destino === 'Enfermaria') {
                prescEnfermaria.classList.remove('hidden');
            }
            
            patientState.stepsCompleted.prescricao = true;
            updateDashboardUI();
            showScreen('otimizacao-prescricao');
        }
        
        function switchTab(tabId) {
            const tabButton = document.getElementById(`tab-${tabId}`);
            if (tabButton.classList.contains('disabled-tab')) {
                return; // Impede a troca para uma aba desativada
            }

            document.querySelectorAll('[id^="content-"]').forEach(content => content.classList.add('hidden'));
            document.querySelectorAll('.calculator-tab').forEach(tab => tab.classList.remove('active', 'text-blue-600'));
            
            document.getElementById(`content-${tabId}`).classList.remove('hidden');
            tabButton.classList.add('active', 'text-blue-600');
        }
        
        function goToTherapyTab(tabId) {
            updateTherapyTabsUI(determinedProfile || 'B'); // Assume Perfil B se n√£o definido, para habilitar a aba
            switchTab(tabId);
            showScreen('calculadora-drogas');
        }


        function toggleFurosemidaUso(isCronico) {
            usoCronicoFurosemida = isCronico;
            const divCronico = document.getElementById('furosemida-cronico-div');
            const btnSim = document.getElementById('furo-sim');
            const btnNao = document.getElementById('furo-nao');
            if (isCronico) {
                divCronico.classList.remove('hidden');
                btnSim.classList.add('selected');
                btnNao.classList.remove('selected');
            } else {
                divCronico.classList.add('hidden');
                btnSim.classList.remove('selected');
                btnNao.classList.add('selected');
            }
        }

        function calcularFurosemida() {
            const resultadoDiv = document.getElementById('resultado-furosemida');
            let doseMin = 0;
            let doseMax = 0;

            if (usoCronicoFurosemida) {
                const doseOral = parseFloat(document.getElementById('dose-oral').value);
                if (isNaN(doseOral) || doseOral <= 0) {
                    resultadoDiv.textContent = 'Por favor, insira uma dose oral v√°lida.';
                    resultadoDiv.classList.remove('hidden', 'bg-green-100', 'text-green-800');
                    resultadoDiv.classList.add('bg-red-100', 'text-red-800');
                    return;
                }
                doseMin = doseOral;
                doseMax = doseOral * 2.5;
                resultadoDiv.textContent = `Dose EV sugerida: ${doseMin} a ${doseMax} mg`;
            } else {
                resultadoDiv.textContent = 'Dose EV sugerida: 20 a 40 mg';
            }
            
            resultadoDiv.classList.remove('hidden', 'bg-red-100', 'text-red-800');
            resultadoDiv.classList.add('bg-green-100', 'text-green-800');
        }
        
        function calcularNitroglicerina() {
            const doseMCGMIN = parseFloat(document.getElementById('ntg-dose').value);
            const resultadoDiv = document.getElementById('resultado-ntg');

            if (isNaN(doseMCGMIN) || doseMCGMIN < 0) {
                 resultadoDiv.innerHTML = 'Por favor, insira uma dose v√°lida.';
                resultadoDiv.classList.remove('hidden', 'bg-green-100', 'text-green-800');
                resultadoDiv.classList.add('bg-red-100', 'text-red-800');
                return;
            }

            // Dilui√ß√£o Padr√£o: 50mg (50.000 mcg) em 250ml = 200 mcg/ml
            const concentration = 200; // mcg/mL
            const rateMLH = ((doseMCGMIN * 60) / concentration).toFixed(1);

            resultadoDiv.innerHTML = `
                <p>Para uma dose de <strong>${doseMCGMIN} mcg/min</strong>, a taxa de infus√£o √©:</p>
                <p class="text-lg font-bold mt-1">${rateMLH} mL/h</p>
                <p class="text-xs text-gray-500">(Dilui√ß√£o Padr√£o: 50mg/250ml)</p>
            `;
             resultadoDiv.classList.remove('hidden', 'bg-red-100', 'text-red-800');
            resultadoDiv.classList.add('bg-green-100', 'text-green-800');
        }

        function calcularInotropicos() {
            const peso = parseFloat(document.getElementById('peso-paciente').value);
            const resultadoDiv = document.getElementById('resultado-inotropicos');

            if (isNaN(peso) || peso <= 0) {
                resultadoDiv.innerHTML = 'Por favor, insira um peso v√°lido.';
                resultadoDiv.classList.remove('hidden', 'bg-green-100', 'text-green-800');
                resultadoDiv.classList.add('bg-red-100', 'text-red-800');
                return;
            }

            const concDobutamina = 1000; // 250mg/250ml
            const concNora = 16; // 4mg/250ml
            
            const doseDobutaminaMin = 2.5;
            const infusaoDobutaminaMin = ((doseDobutaminaMin * peso * 60) / concDobutamina).toFixed(1);

            const doseNoraMin = 0.05;
            const infusaoNoraMin = ((doseNoraMin * peso * 60) / concNora).toFixed(1);
            
            resultadoDiv.innerHTML = `
                <div class="mb-3">
                    <p class="font-bold">Dobutamina (iniciar 2.5 mcg/kg/min):</p>
                    <p class="text-sm">Taxa de Infus√£o Inicial: <strong>${infusaoDobutaminaMin} ml/h</strong></p>
                    <p class="text-xs text-gray-500">(Dilui√ß√£o Padr√£o: 250mg/250ml)</p>
                </div>
                <div>
                    <p class="font-bold">Noradrenalina (iniciar 0.05 mcg/kg/min):</p>
                    <p class="text-sm">Taxa de Infus√£o Inicial: <strong>${infusaoNoraMin} ml/h</strong></p>
                    <p class="text-xs text-gray-500">(Dilui√ß√£o Padr√£o: 4mg/250ml)</p>
                </div>`;

            resultadoDiv.classList.remove('hidden', 'bg-red-100', 'text-red-800');
            resultadoDiv.classList.add('bg-green-100', 'text-green-800');
        }
        
    </script>
</body>
</html>

